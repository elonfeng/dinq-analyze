# 调试指南

本文档提供了如何在VSCode中调试DINQ项目的指南。

## 调试配置

已经为项目配置了以下调试选项：

1. **Python: new_server.py (Debug Mode)** - 以调试模式启动主服务器
2. **Python: Current File** - 调试当前打开的文件
3. **Python: Debug transform_profile.py** - 专门用于调试transform_profile.py模块

## 如何使用调试功能

### 设置断点

1. 在VSCode中打开要调试的文件
2. 点击行号左侧的空白区域设置断点（会出现一个红色圆点）

### 启动调试会话

1. 点击VSCode左侧的"运行和调试"图标（或按F5）
2. 从下拉菜单中选择适当的调试配置
3. 点击绿色的"开始调试"按钮

### 调试transform_profile.py

为了方便调试`transform_profile.py`，项目中提供了一个专门的测试脚本`debug_transform_profile.py`。这个脚本包含了一个带有`level_info`和`evaluation_bars`的示例数据，可以用来测试数据转换逻辑。

使用方法：

1. 在`server/transform_profile.py`中设置断点
2. 选择"Python: Debug transform_profile.py"配置
3. 启动调试会话

### 调试主服务器

要调试主服务器：

1. 在相关文件中设置断点
2. 选择"Python: new_server.py (Debug Mode)"配置
3. 启动调试会话
4. 使用浏览器或API客户端访问服务器端点，触发断点

## 调试控制

调试会话启动后，VSCode会显示调试控制栏，包含以下功能：

- **继续(F5)**: 继续执行直到下一个断点
- **单步跳过(F10)**: 执行当前行并移动到下一行
- **单步调试(F11)**: 步入函数调用
- **单步跳出(Shift+F11)**: 从当前函数返回
- **重启(Ctrl+Shift+F5)**: 重启调试会话
- **停止(Shift+F5)**: 终止调试会话

## 查看变量和调用栈

调试过程中，VSCode左侧面板会显示：

- **变量**: 当前作用域中的所有变量
- **监视**: 可以添加表达式来监视其值
- **调用栈**: 显示当前的函数调用链

## 调试技巧

1. 使用`logger.info()`语句在关键点输出变量值
2. 在复杂的数据结构上设置断点，使用调试控制台检查其内容
3. 使用"条件断点"（右键点击断点）在特定条件下才触发断点
4. 使用"日志点"（右键点击断点选择"日志消息"）在不中断执行的情况下记录信息

## 常见问题

- **断点不触发**: 确保代码路径确实被执行到，可以添加日志语句确认
- **导入错误**: 确保PYTHONPATH设置正确，包含项目根目录
- **Flask热重载问题**: 如果修改代码后断点位置变化，可能需要重启调试会话
